<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Project Manager</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <script src="js/auth.js" defer></script>
    <script src="js/api.js" defer></script>
</head>
<body>

    <main class="container" style="max-width: 500px; margin-top: 5rem;">

        <article x-data="{
            username: '',
            password: '',
            errorMessage: '',
            isLoading: false,

            /**
             * Handles the form submission.
             * This function will be called by our <form>
             */
            async handleLogin() {
                this.isLoading = true;
                this.errorMessage = '';

                try {
                    // We will create api.login() in 'js/api.js'.
                    // This function will:
                    // 1. POST to /api/auth/token
                    // 2. On success, save the token using auth.saveToken()
                    // 3. On failure, throw an error
                    await api.login(this.username, this.password);

                    // If login is successful, redirect to the dashboard
                    window.location.href = 'dashboard.html';

                } catch (error) {
                    // If api.login() throws an error, display it
                    this.errorMessage = error.message;
                } finally {
                    this.isLoading = false;
                }
            }
        }">

            <h2 style="text-align: center;">Login</h2>
            
            <form @submit.prevent="handleLogin">

                <label for="username">Username</label>
                <input 
                    type="text" 
                    id="username" 
                    name="username" 
                    x-model="username"
                    required
                    placeholder="e.g., jsmith"
                    :aria-invalid="errorMessage ? 'true' : 'false'"
                >

                <label for="password">Password</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    x-model="password"
                    required
                    :aria-invalid="errorMessage ? 'true' : 'false'"
                >
                
                <small 
                    x-show="errorMessage" 
                    x-text="errorMessage"
                    style="color: var(--pico-del-color);"
                ></small>

                <button 
                    type="submit" 
                    :disabled="isLoading"
                    x-text="isLoading ? 'Logging in...' : 'Login'"
                ></button>
            </form>
            
            <footer>
                <small>Don't have an account? <a href="register.html">Sign up now</a></small>
            </footer>

        </article>
    </main>

</body>
</html>